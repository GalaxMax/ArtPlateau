<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>The Art Plateau</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
<div class="banner">    <!--header for alle nettsider-->
    <div class="header">
        <h1>The Art Plateau</h1>
    </div>
</div>

<div id="cookies" style="background-color: white">
    <h1><br><br>Denne nettsiden bruker cookies.</h1>
    <p>Ved å trykke på "Aksepter" forstår du at denne nettsiden lagrer personlig data for en bedre brukeropplevelse.</p>
    <button id="cookieAksepter">Aksepter</button>
</div>

<ul class="navigering">    <!--navigering meny for alle sider-->
    <li class="meny"><a href="index.html">Home</a></li>
    <li class="meny"><a class="active" href="gallery.html">Galleri</a></li>
    <li class="meny"><a href="planDesign.html">Plan</a></li>
    <li class="meny"><a href="planDesign.html">Utforming</a></li>
    <li class="meny"><a href="planDesign.html">Algoritmer</a></li>
    <li class="meny"><a href="planDesign.html">Sjekkliste</a></li>
    <li class="meny"><a href="webserver.html">Webserver</a></li>
    <li class="meny"><a href="webserver.html">Cookies</a></li>
    <li class="meny"><a href="webserver.html">Webutvikling</a></li>
    <li class="meny"><a href="vurdering.html">Ukraina Krigen</a></li>
</ul>

<div class="galleriPlass">
<div class="panels">
    <div class="post">
        <p><b>Her kan du legge til dine egne bilder!</b></p>
        <label for="brukerNavn">Brukernavn</label>
        <input type="text" id="brukerNavn">

        <label for="beskrivelse">Beskrivelse</label>
        <textarea id="beskrivelse" rows="4" cols="40"></textarea>

        <label for="velgKategori">Velg en kategori</label>
        <select class="kategoriMeny" id="velgKategori">
            <option class="kategoriMenyValg">Dyr</option>
            <option class="kategoriMenyValg">By</option>
            <option class="kategoriMenyValg">Sport</option>
            <option class="kategoriMenyValg">Mat</option>
            <option class="kategoriMenyValg">Natur</option>
            <option class="kategoriMenyValg">Tech</option>
        </select>

        <label for="tags">Legg til en Tag</label>
        <input type="text" id="tags">

        <label for="imgURL">Bilde URL</label>
        <input type="text" id="imgURL">

        <button class="lastOpp" id="lagre">Legg ut bilde</button>
    </div>

    <div class="sort">
        <label for="sorterKategori">Sorter etter kategori</label>
        <select class="kategoriMeny" id="sorterKategori">
            <option class="kategoriMenyValg">Alle</option>
            <option class="kategoriMenyValg">Dyr</option>
            <option class="kategoriMenyValg">By</option>
            <option class="kategoriMenyValg">Sport</option>
            <option class="kategoriMenyValg">Mat</option>
            <option class="kategoriMenyValg">Natur</option>
            <option class="kategoriMenyValg">Tech</option>
        </select>
        <button class="lastOpp" id="sorter">Sorter Innlegg</button>
    </div>
</div>

<div id="innleggSamling" class="innleggFelt"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDpLtSVKfz3rcmcqX3-y9Gg-zIcHc0P8Ng",
        authDomain: "the-art-plateau.firebaseapp.com",
        projectId: "the-art-plateau",
        storageBucket: "the-art-plateau.appspot.com",
        messagingSenderId: "684643482427",
        appId: "1:684643482427:web:715b478b5ae4a170e1d51e"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    let db = firebase.firestore();

    let brukerNavnEl = document.querySelector("#brukerNavn");
    let beskrivelseEl = document.querySelector("#beskrivelse");
    let velgKategoriEl = document.querySelector("#velgKategori");
    let tagsEl = document.querySelector("#tags");
    let imgURLEl = document.querySelector("#imgURL");
    let buttonEl = document.querySelector("#lagre");
    let sorterKnappEl = document.querySelector("#sorter");
    let sorterkategoriEl = document.querySelector("#sorterKategori");
    let innleggSamlingEl = document.querySelector('#innleggSamling');

    let d = new Date();
    let dagEl = d.getDate();
    let maanedEl = d.getMonth();
    let aarEl = d.getFullYear();

    function lastOppBilde() {   //legger til et nytt dokument i db med bruker input//
        db.collection("galleri").add({
            navn: brukerNavnEl.value,
            beskrivelse: beskrivelseEl.value,
            kategori: velgKategoriEl.value,
            tags: tagsEl.value,
            imgURL: imgURLEl.value,
            dag: dagEl,
            maaned: maanedEl,
            aar: aarEl
        });
    }

    buttonEl.addEventListener("click", lastOppBilde) //knapp for å utføre funksjon//
    sorterKnappEl.addEventListener("click", slett)
    sorterKnappEl.addEventListener("click", sorterValgtKategori)


    function innleggListeElement(dokument) {       //viser data//

        let innleggEl = document.createElement("div");    //lager elementer//
        let navnEl = document.createElement("div");
        let fotoEl = document.createElement("div")
        let imgEl = document.createElement("img")
        let kategoriEl = document.createElement("div")
        let beskrivelseOgTagsEl = document.createElement("div")
        let tagsEl = document.createElement("div")
        let beskrivelseEl = document.createElement('p')

        navnEl.innerHTML = "Av: " + dokument.data().navn
        kategoriEl.innerHTML = dokument.data().kategori
        tagsEl.innerHTML = dokument.data().tags
        beskrivelseEl.innerHTML = dokument.data().beskrivelse
        srcEl = dokument.data().imgURL

        innleggEl.classList.add('innlegg');
        navnEl.classList.add('navn');
        fotoEl.classList.add('foto');
        imgEl.classList.add('bilde');
        kategoriEl.classList.add('kategori');
        beskrivelseOgTagsEl.classList.add('beskrivelseOgTags');
        tagsEl.classList.add('tags');

        imgEl.src = srcEl

        fotoEl.appendChild(imgEl)
        beskrivelseOgTagsEl.appendChild(tagsEl);
        beskrivelseOgTagsEl.appendChild(beskrivelseEl);
        innleggEl.appendChild(navnEl);
        innleggEl.appendChild(fotoEl);
        innleggEl.appendChild(kategoriEl);
        innleggEl.appendChild(beskrivelseOgTagsEl);

        innleggSamlingEl.appendChild(innleggEl);
    }

    db.collection("galleri").get().then((snapshot) => {   //henter dokumenter//
        let dokumenter = snapshot.docs;

        for (let i = 0; i < dokumenter.length; i++) {   //gjør vært dokument til tabell rad//
            innleggListeElement(dokumenter[i]);
        }
    });

    db.collection("galleri").onSnapshot(snapshot => {
        db.collection("galleri").orderBy("navn").get().then((snapshot) => {
            // Henter ut dokumentene
            let dokumenter = snapshot.docs;

            // Tømmer listeelementet (<div>-elementet der huskelisten lages)
            innleggSamlingEl.innerHTML = "";

            // Går gjennom dokumentene og lager et element for hvert av dem
            for (let i = 0; i < dokumenter.length; i++) {
                innleggListeElement(dokumenter[i]);
            }
    })
    })

    function slett() {
        while (innleggSamlingEl.firstChild) {    //sletter tabellen//
            innleggSamlingEl.removeChild(innleggSamlingEl.lastChild);
        }
    }

    function sorterValgtKategori(){
        let indexVerdi = sorterkategoriEl.selectedIndex
        if (indexVerdi == 0){
            alle()
        }
        if (indexVerdi == 1){
            sortDyr()
        }
        if (indexVerdi == 2){
            sortBy()
        }
        if (indexVerdi == 3){
            sortSport()
        }
        if (indexVerdi == 4){
            sortMat()
        }
        if (indexVerdi == 5){
            sortNatur()
        }
        if (indexVerdi == 6){
            sortTech()
        }
    }
    function alle(){
        db.collection("galleri").orderBy("navn").get().then((snapshot) => {
            //henter data fra dokumenter der parti inneholder Ap//
            let dokumenter = snapshot.docs;

            for (let i = 0; i < dokumenter.length; i++) {   //lager ny tabell//
                innleggListeElement(dokumenter[i]);
            }
        })
    }
    function sortDyr(){
        db.collection("galleri").where("kategori", "==", "Dyr").get().then((snapshot) => {
            //henter data fra dokumenter der parti inneholder Ap//
            let dokumenter = snapshot.docs;

            for (let i = 0; i < dokumenter.length; i++) {   //lager ny tabell//
                innleggListeElement(dokumenter[i]);
            }
        })
    }
    function sortBy(){
        db.collection("galleri").where("kategori", "==", "By").get().then((snapshot) => {
            //henter data fra dokumenter der parti inneholder Ap//
            let dokumenter = snapshot.docs;

            for (let i = 0; i < dokumenter.length; i++) {   //lager ny tabell//
                innleggListeElement(dokumenter[i]);
            }
        })
    }
    function sortSport(){
        db.collection("galleri").where("kategori", "==", "Sport").get().then((snapshot) => {
            //henter data fra dokumenter der parti inneholder Ap//
            let dokumenter = snapshot.docs;

            for (let i = 0; i < dokumenter.length; i++) {   //lager ny tabell//
                innleggListeElement(dokumenter[i]);
            }
        })
    }
    function sortMat(){
        db.collection("galleri").where("kategori", "==", "Mat").get().then((snapshot) => {
            //henter data fra dokumenter der parti inneholder Ap//
            let dokumenter = snapshot.docs;

            for (let i = 0; i < dokumenter.length; i++) {   //lager ny tabell//
                innleggListeElement(dokumenter[i]);
            }
        })
    }
    function sortNatur(){
        db.collection("galleri").where("kategori", "==", "Natur").get().then((snapshot) => {
            //henter data fra dokumenter der parti inneholder Ap//
            let dokumenter = snapshot.docs;

            for (let i = 0; i < dokumenter.length; i++) {   //lager ny tabell//
                innleggListeElement(dokumenter[i]);
            }
        })
    }
    function sortTech(){
        db.collection("galleri").where("kategori", "==", "Tech").get().then((snapshot) => {
            //henter data fra dokumenter der parti inneholder Ap//
            let dokumenter = snapshot.docs;

            for (let i = 0; i < dokumenter.length; i++) {   //lager ny tabell//
                innleggListeElement(dokumenter[i]);
            }
        })
    }
</script>
<script>
    let cookieEl = document.querySelector("#cookies")
    let cookieButtonEl = document.querySelector("#cookieAksepter");

    cookieButtonEl.addEventListener("click", cookie)

    if (localStorage.cookies) {
        cookieEl.innerHTML = "";
        document.getElementById('cookies').style.backgroundColor = "";
    }
    else {
    }

    function cookie() {
        localStorage.cookies = 1;
        location.reload()
    }
</script>
</body>
</html>